{% extends "base.html" %}
{% block title %}ğŸš¨ ì‹ ê³ í•˜ê¸°{% endblock %}
{% block content %}

<h2>ğŸš¨ ì‹ ê³ í•˜ê¸°</h2>

<form method="post">
  {{ form.hidden_tag() }}

  <label for="target_type">ì‹ ê³  ëŒ€ìƒ ìœ í˜•:</label>
  <select name="target_type" id="target_type" onchange="updateTargetList()" required>
    <option value="">-- ì„ íƒ --</option>
    <option value="user">ìœ ì €</option>
    <option value="product">ìƒí’ˆ</option>
  </select>
  <br><br>

  <label for="target_id">ì‹ ê³  ëŒ€ìƒ ì„ íƒ:</label>
  <select name="target_id" id="target_id" required>
    <option value="">ë¨¼ì € ëŒ€ìƒ ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
  </select>
  <br><br>

  <label for="reason">ì‹ ê³  ì‚¬ìœ :</label><br>
  <textarea name="reason" rows="4" cols="50" maxlength="200" required></textarea><br><br>

  <button type="submit" style="background-color: crimson; color: white; border: none; padding: 8px 16px; border-radius: 4px;">
    ğŸš¨ ì‹ ê³  ì œì¶œ
  </button>
</form>

<script>
  const users = {{ users|tojson }};
  const products = {{ products|tojson }};

  function updateTargetList() {
    const targetType = document.getElementById("target_type").value;
    const targetSelect = document.getElementById("target_id");
    targetSelect.innerHTML = "";

    const defaultOption = document.createElement("option");
    defaultOption.text = "-- ì„ íƒ --";
    defaultOption.value = "";
    targetSelect.appendChild(defaultOption);

    let list = [];
    if (targetType === "user") list = users;
    else if (targetType === "product") list = products;

    list.forEach(item => {
      const option = document.createElement("option");
      option.value = item.id;
      option.text = targetType === "user" ? item.username : item.title;
      targetSelect.appendChild(option);
    });
  }
</script>

{% endblock %}
